<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>Index</title>
    </head>
    <body>
        <script src="/socket.io/socket.io.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
        <p id="msender" hidden><%= sender %></p>
        <p id="mreceiver" hidden><%= receiver %></p>
        <form action='/' method='POST'>
            <input type='text' id='send_msg'>
            <input type='submit' value='Send'>
        </form>
        <div style="overflow:scroll; width:500px; height:700px; border: 1px solid black;
        padding: 20px 20px 20px 20px;">
            <ul id="chat_log" style="list-style: none; overflow-y: auto;">
                <li style="text-align:center;">----Chatting with <%= receiver %>----</li>
                <% for(var i=0 ; i<msg_log.length; i++) { %>
                    <% if(msg_log[i].sender==sender) { %>
                        <li style="text-align:right;"><%= msg_log[i].content %></li>
                    <% } else { %>
                        <li style="text-align:left;"><%= msg_log[i].content %></li>
                    <% } %> 
                <% } %> 
            </ul>
        </div>
        <script>
            var socket = io();
            var sender = document.getElementById('msender').innerHTML;
            var receiver = document.getElementById('mreceiver').innerHTML;
            var room_name = "default room";
            console.log("sender: " + sender);
            console.log("receiver: " + receiver);
            if (sender<receiver){
                room_name = sender + receiver;
            }
            else{
                room_name = receiver + sender;
            }
            console.log(room_name);
            socket.emit('join_room', room_name);
            $('form').submit(() => { // message 전송
                var message = $('#send_msg').val();
                $('#chat_log').append($('<li style="text-align:right;">')
                    .text(message));
                $('#send_msg').val('');
                console.log("Sent message");
                socket.emit('send_msg', message, sender, receiver);
                return false;
            });
            socket.on('receive_msg', (rcvmsg) => {
                console.log(rcvmsg);
                $('#chat_log').append($('<li style="text-align:left;">')
                    .text(rcvmsg));
            });
        </script>
    </body>
</html>